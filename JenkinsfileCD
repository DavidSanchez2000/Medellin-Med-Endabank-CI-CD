pipeline {
    
  agent any

  stages { 
        stage('Deployment') {
            environment {
                registry = 'davidsanchez21/endabank'
                registryCredential = 'dockerhublogin'
            }
            steps{
                script {
                    docker.withRegistry( 'https://registry.hub.docker.com', registryCredential ) {
                    dockerImage.pull("latest")
                    }
                }
                sshagent(['sshk8s']) {
                    sh "ssh -o StrictHostKeyChecking=no -l  davidalejandro_sanchezarias 10.0.1.6 'docker pull davidsanchez21/endabank:latest' "
                    sh "ssh -o StrictHostKeyChecking=no -l  davidalejandro_sanchezarias 10.0.1.6 'docker run --env-file ./.env -d -p 8081:8080 davidsanchez21/endabank:latest' "       
                }        
            }
        }
    }
}